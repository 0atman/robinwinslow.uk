<!doctype html>

<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

     	<title>Don't ever commit binary files to Git! Or what to do if you do. | by Robin</title>

    	<meta name="description" content="Why you shouldn't commit binary files to a distributed version control system - and how you can remove them completely if you do.">
        <meta name="viewport" content="width=device-width">

        <link rel="canonical" href="https://robinwinslow.uk/2013/06/11/dont-ever-commit-binary-files-to-git/" />

        <link type="text/css" rel="stylesheet" href="/assets/global-cde306f7329733dd6abd0056b28c2061da3b79079c896e4286449114bfff9d39.css">

        <script>
            if (location.hostname=="robinwinslow.uk") {
                var _gaq=[
                    ['_require', 'inpage_linkid', '//www.google-analytics.com/plugins/ga/inpage_linkid.js'],
                    ['_setAccount','UA-2993676-8'],
                    ['_trackPageview']
                ];
                (function() {
                    var ga = document.createElement('script');
                    ga.type = 'text/javascript';
                    ga.async = true;
                    ga.src = '//www.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            }
        </script>

        <link type="application/atom+xml" rel="alternative" href="/rss.xml" />
    </head>

    <body class="">
        <!--[if lt IE 9]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/?locale=en">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <header class="site-header">
            <h1>The blog of <a href="/">Robin</a></h1>

            <nav class="inline-navigation site-navigation">
                <ul>
                    <li class=""><a href="/dev/">Web dev</a></li>
                    <li class=""><a href="/politics/">Politics</a></li>
                    <li class=""><a href="/musings/">Musings</a></li>
                    <li class=""><a href="/">All articles</a></li>
                </ul>
            </nav>
        </header>

        <article>
    <header class="page-header">
        <date>11 Jun 2013</date>

        <h1>Don't ever commit binary files to Git! Or what to do if you do.</h1>
    </header>

    <p>Git is a great <a href="http://en.wikipedia.org/wiki/Distributed_revision_control">distributed version control system</a>. It&#39;s fantastically for easily storing changed to <em>text files</em> wherever you are, and then easily copying them up to a server or servers or sharing them with your friends locally.</p>

<h1 id="avoid-binary-files">Avoid binary files</h1>

<p>&quot;Text files&quot; is the key here. It easily lets you see textual changes. But this function is useless for binary data. Data about changes in binary files just makes the commits impossible to read.</p>

<p>There is another very good reason for keeping binary files out of your repository: They are usually much bigger. Images, videos and compiled binaries are all much bigger than text files. If you commit them to your repository, the size of your repository will become much larger.</p>

<p>This matters not because storage is expensive - it&#39;s not. It matter because the point of using a <em>distributed</em> VCS is that it makes it cheap and easy to <em>clone and navigate</em>. You want to be able to spin up a new machine and copy the repository as quickly as possible. You want to be able to switch branches as quickly as possible. If you commit any significant number of binary files you will see all of these tasks slow down considerably.</p>

<p>It&#39;s important to <em>never commit binary files</em> because once you&#39;ve commit them they are <em>in the repository history</em> and are very annoying to remove. You can delete the files from the <em>current version</em> of the project - but they&#39;ll remain in the repository history, meaning that the overall repository size will still be large.</p>

<h1 id="how-you-can-fix-it">How you can fix it</h1>

<p>You can totally remove large files from the repository only by <em>rewriting history</em>. This is extremely dangerous because it will overwrite all commits since files were added, producing a completely different version of the revision history.</p>

<p>If you have shared your repository with anyone, or stored it anywhere else (like <a href="https://github.com">Github</a>) you must make sure that <em>all versions of these repositories</em> get updated to your new version before anyone tries to add any new work on top. This can be a huge ball-ache.</p>

<p>However, if you <strong>understand the risks</strong> you can rewrite history using a <a href="https://gist.github.com/nottrobin/5758221">fantastic script</a> I found on <a href="http://dound.com/2009/04/git-forever-remove-files-or-folders-from-history/">David Underhill&#39;s blog</a>. It first uses <code>git filter-branch</code> to remove the files from the commits, and then deletes the relevant caches of the files.</p>

<p>Make sure you&#39;ve committed all your work and have a backup copy of your up-to-date repository somewhere. Then do the following:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Get hold of the script</span>
<span class="gp">$ </span>wget -O- https://gist.github.com/nottrobin/5758221/raw/ff740b4ac3b8ab80d40e3598ec461400dce42b5d/git-prune | sudo tee -a /usr/bin/git-prune-files
<span class="gp">$ </span>sudo chmod +x /usr/bin/git-prune-files

<span class="c"># Change to your project directory</span>
<span class="gp">$ </span><span class="nb">cd</span> ~/projects/my-git-project

<span class="c"># Remove the relevant files</span>
<span class="gp">$ </span>git-prune-files static/images
</code></pre></div>
<p>This might take a while and should give you an output something like this:</p>
<div class="highlight"><pre><code class="language-" data-lang="">...
rm 'static/images/9419.jpg'
rm 'static/images/9420.jpg'
rm 'static/images/9421.jpg'
Rewrite 325bfc6a34e33a9d4ef4b19ec88b52dfdc3f1e74 (9421/9421)
Ref 'refs/heads/master' was rewritten
Counting objects: 22041, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (21761/21761), done.
Writing objects: 100% (22041/22041), done.
Total 22041 (delta 15312), reused 5817 (delta 0)
</code></pre></div>
<p>Now make <em>absolutely sure</em> this version of the repository replaces <em>all copies</em> of your repository <em>immediately</em>.</p>


<!-- Generate subnav for article -->
<script type="text/javascript" src="/assets/subnav-020636817964deb048fb98c55583f2981ff145d2db5e13d5c3b624c4ef8613f4.js"></script>


    <hr>

    <nav class="tags-list muted">
        <label>Tags</label>

        <ul>

            <li><a href="/postsbytag/#dev">dev</a></li>

            <li><a href="/postsbytag/#back-end">back-end</a></li>

            <li><a href="/postsbytag/#git">git</a></li>

        </ul>
    </nav>


<hr/>

<div id="disqus_thread" class="comments"></div>

</article>


<nav class="related-nav article-index">
    <h1>Similar articles</h1>

    <ul>
    
        
            
                <li>
    <article>
        <a href="/2016/06/23/fix-docker-networking-dns/">
            <date>23 Jun 2016</date>
            <h1>Fix Docker's networking DNS config</h1>
            <p>Within certain networks, docker is unable to resolve DNS correctly. When this happens, here's how to fix it.</p>
        </a>


        <nav class="tags-list muted">
            <label>Tags</label>

            <ul>

                <li><a href="/postsbytag/#back-end">back-end</a></li>

                <li><a href="/postsbytag/#dev">dev</a></li>

                <li><a href="/postsbytag/#canonical">canonical</a></li>

            </ul>
        </nav>

    </article>
</li>

            
        
            
                <li>
    <article>
        <a href="/2016/02/25/adding-cache-headers-to-django/">
            <date>25 Feb 2016</date>
            <h1>Django HTTP headers: Controlling caching on cn.ubuntu.com</h1>
            <p>As optimising web performance becomes more and more important, it's becoming essential to carefully manage your caching headers. But Django doesn't make it hat easy.</p>
        </a>


        <nav class="tags-list muted">
            <label>Tags</label>

            <ul>

                <li><a href="/postsbytag/#dev">dev</a></li>

            </ul>
        </nav>

    </article>
</li>

            
        
            
                <li>
    <article>
        <a href="/2016/02/14/simplest-wsgi-application/">
            <date>14 Feb 2016</date>
            <h1>Creating a minimal Python application server for experimenting</h1>
            <p>As a web developer, it can be incredibly useful to be able to spin up a quick server to inspect and manipulate raw requests. And if you're used to working in Python, this little script is just the ticket.</p>
        </a>


        <nav class="tags-list muted">
            <label>Tags</label>

            <ul>

                <li><a href="/postsbytag/#dev">dev</a></li>

                <li><a href="/postsbytag/#back-end">back-end</a></li>

            </ul>
        </nav>

    </article>
</li>

            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
    </ul>
</nav>


<script>
    if (location.hostname=="robinwinslow.uk") {
        var disqus_shortname = 'robin-blog'; // required: replace example with your forum shortname

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    }
</script>

<noscript>Please enable JavaScript to view the comments (powered by <a href="http://disqus.com/?ref_noscript">Disqus</a>)</noscript>


        <footer class="site-footer">
            <nav class="vcard" id="contact-information">
                <h1>Contact information</h1>

                <ul>
                    <li><a href="mailto:robin+blog@robinwinslow.uk" class="email">robin@robinwinslow.uk</a></li>
                    <li><a href="tel:07795070704" class="tel">07795070704</a></li>
                    <li><a href="https://www.google.co.uk/maps?q=ng7">NG7, Nottingham, UK</a></li>
                </ul>
            </nav>

            <nav>
                <h1>Further writing</h1>

                <ul>
                    <li><a href="http://cv.robinwinslow.uk">cv.robinwinslow.uk</a></li>
                    <li><a href="http://design.canonical.com/author/nottrobin/">design.canonical.com</a></li>
                    </li>
                </ul>
            </nav>

            <nav>
                <h1>Profiles</h1>

                <ul>
                    <li><a href="https://twitter.com/nottrobin">twitter.com (@nottrobin)</a></li>
                    <li><a href="https://facebook.com/robinwinslowmorris">facebook.com (robinwinslowmorris)</a></li>
                    <li><a href="https://github.com/nottrobin/">github.com (nottrobin)</a>
                </ul>
            </nav>

            <p>
                All articles are written by me, <a href="https://plus.google.com/104026832761488144614" rel="author">Robin Winslow</a>, unless otherwise stated. Feel free to use any of my writing, but please <a href="http://creativecommons.org/licenses/by/4.0/">give me attribution</a>.
            </p>

            <p>You're free to download this entire site <a href="https://github.com/nottrobin/robinwinslow.uk/">from github</a>, and <a href="http://creativecommons.org/publicdomain/zero/1.0/">do whatever you like</a> with the code.</p>

            <p><a href="https://github.com/nottrobin/robinwinslow.uk/" class="github-fork">Fork me on github.</a></p>
        </footer>
		<!--[if !(lt IE 8)]><!-->
		<script type="text/javascript">
		  (function(){
			var e = document.createElement('script'); e.type='text/javascript'; e.async = true;
			e.src = 'https://www.eff.org/ngw/widget.min.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(e, s);
		  })();
		</script>
		<!--<![endif]-->
    </body>
</html>
